<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± - Ù…Ø­Ù…ÙŠ</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        :root { --primary: #007AFF; --bg: #000000; --card: #1C1C1E; --accent: #32D74B; --danger: #FF3B30; }
        
        /* Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù„Ø§Ù‚: Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø³Ø­Ø¨ ÙˆØ¬Ø¹Ù„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù…Ø±Ù† */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg); color: white; margin: 0; padding: 0;
            display: flex; flex-direction: column; 
            min-height: 100vh; 
            overflow-y: auto; /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ */
            -webkit-overflow-scrolling: touch; /* Ø³Ø­Ø¨ Ù†Ø§Ø¹Ù… Ø¹Ù„Ù‰ iOS */
        }

        .header { padding: 15px; text-align: center; background: var(--card); border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        
        /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„ØªÙŠ ØªØ³Ø¨Ø¨ ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø´Ø§Ø´Ø© */
        .content { 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            flex: none; /* Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ…Ø¯Ø¯ Ø§Ù„Ù‚Ø³Ø±ÙŠ */
        }
        
        .video-container {
            position: relative; width: 100%; background: #000; border-radius: 15px; overflow: hidden;
            aspect-ratio: 16 / 9; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            will-change: transform; /* ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© */
        }
        video { width: 100%; height: 100%; object-fit: contain; }

        .controls-card {
            background: var(--card); padding: 15px; border-radius: 15px;
            display: flex; flex-direction: column; gap: 12px;
            margin-bottom: 20px; /* Ù…Ø³Ø§Ø­Ø© ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø³Ø­Ø¨ */
        }
        
        #adminPanel { display: none; border: 1px solid var(--primary); }

        input { 
            background: #2C2C2E; border: 1px solid #3d3d3d; padding: 12px; border-radius: 10px; 
            color: white; font-size: 16px; outline: none; -webkit-appearance: none;
        }
        button { 
            background: var(--primary); color: white; border: none; padding: 12px; 
            border-radius: 10px; font-weight: 600; font-size: 15px; cursor: pointer;
        }
        .status-bar { 
            font-size: 13px; color: var(--accent); text-align: center; 
            padding: 10px; background: rgba(50, 215, 75, 0.1); border-radius: 8px;
        }
        .viewer-badge {
            display: inline-block; background: var(--danger); color: white;
            padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold;
            align-self: center; margin-bottom: 5px;
        }
    </style>
</head>
<body>

<div class="header">
    <h3 style="margin:0;">Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ù…ØªØ²Ø§Ù…Ù† ğŸ¬</h3>
</div>

<div class="content">
    <div class="viewer-badge">â— Ù…Ø¨Ø§Ø´Ø±: <span id="viewerCount">0</span></div>

    <div class="video-container">
        <video id="livePlayer" controls playsinline webkit-playsinline preload="auto"></video>
    </div>

    <div id="syncStatus" class="status-bar">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...</div>

    <div class="controls-card" id="loginPanel">
        <input type="password" id="passInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„ØªØ­ÙƒÙ…...">
        <button onclick="checkPassword()">Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„</button>
    </div>

    <div class="controls-card" id="adminPanel">
        <div style="color:var(--accent); font-size:12px; font-weight:bold;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ğŸ”’</div>
        <input type="url" id="urlInput" placeholder="Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (MP4/M3U8)...">
        <button onclick="updateGlobalVideo()">ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
        authDomain: "videos-5e336.firebaseapp.com",
        databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
        projectId: "videos-5e336",
        storageBucket: "videos-5e336.firebasestorage.app",
        messagingSenderId: "300218651134",
        appId: "1:300218651134:web:4bd24df8e555e62828f0af"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('live_sync');
    const viewersRef = firebase.database().ref('viewers_presence');
    
    const player = document.getElementById('livePlayer');
    const statusDiv = document.getElementById('syncStatus');
    const viewerCountSpan = document.getElementById('viewerCount');
    
    let isRemoteUpdate = false;
    let isAdmin = false;

    // Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†
    const myPresenceRef = viewersRef.push(true);
    myPresenceRef.onDisconnect().remove();
    viewersRef.on('value', (snapshot) => {
        viewerCountSpan.innerText = snapshot.numChildren() || 0;
    });

    function checkPassword() {
        const pass = document.getElementById('passInput').value;
        if(pass === "1234") { 
            isAdmin = true;
            document.getElementById('loginPanel').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'flex';
            statusDiv.innerText = "ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù†Ø´Ø· âœ…";
        } else {
            alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©!");
        }
    }

    function updateGlobalVideo() {
        const url = document.getElementById('urlInput').value;
        if(url && isAdmin) {
            db.set({ url: url, status: "play", time: 0, timestamp: Date.now() });
        }
    }

    db.on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        isRemoteUpdate = true;

        if (player.src !== data.url) {
            player.src = data.url;
            player.load();
        }

        if (Math.abs(player.currentTime - data.time) > 3) {
            player.currentTime = data.time;
        }

        if (data.status === "play" && player.paused) {
            player.play().catch(() => { statusDiv.innerText = "Ø¥Ø¶ØºØ· Play Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© ğŸ”Š"; });
        } else if (data.status === "pause" && !player.paused) {
            player.pause();
        }

        setTimeout(() => { isRemoteUpdate = false; }, 1000);
    });

    player.onplay = () => { if (!isRemoteUpdate && isAdmin) db.update({ status: "play", time: player.currentTime }); };
    player.onpause = () => { if (!isRemoteUpdate && isAdmin) db.update({ status: "pause", time: player.currentTime }); };
    
    setInterval(() => {
        if (isAdmin && !player.paused && !isRemoteUpdate) {
            db.update({ time: player.currentTime });
        }
    }, 4000);

</script>
</body>
</html>
