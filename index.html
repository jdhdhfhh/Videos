<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ù…ØªØ²Ø§Ù…Ù† - Firebase</title>
    <style>
        :root { --primary: #008cff; --bg: #121212; --card: #1e1e1e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); width: 90%; max-width: 800px; text-align: center; }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #333; background: #000; color: #fff; outline: none; }
        button { padding: 12px 20px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { opacity: 0.8; }
        video { width: 100%; border-radius: 12px; background: #000; outline: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .badge { display: inline-block; padding: 5px 12px; background: #333; border-radius: 20px; font-size: 12px; margin-top: 15px; color: #aaa; }
    </style>
</head>
<body>

<div class="container">
    <h2>Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø¨Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ğŸ¬</h2>
    <div class="input-group">
        <input type="text" id="urlInput" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù‡Ù†Ø§ (mp4)...">
        <button onclick="changeVideo()">ØªØºÙŠÙŠØ± Ù„Ù„ÙƒÙ„</button>
    </div>

    <video id="livePlayer" controls playsinline></video>
    
    <div class="badge" id="syncStatus">Ù…ØªØµÙ„ ÙˆÙ…Ø²Ø§Ù…Ù† Ù…Ø¹ Ø§Ù„Ø¬Ù…ÙŠØ¹</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

<script>
    // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    const firebaseConfig = {
        apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
        authDomain: "videos-5e336.firebaseapp.com",
        databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
        projectId: "videos-5e336",
        storageBucket: "videos-5e336.firebasestorage.app",
        messagingSenderId: "300218651134",
        appId: "1:300218651134:web:4bd24df8e555e62828f0af"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('live_sync');
    const player = document.getElementById('livePlayer');
    let isUpdating = false; // Ù„Ù…Ù†Ø¹ "Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠØ©" Ø¨ÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„

    // 1. ÙˆØ¸ÙŠÙØ© ØªØºÙŠÙŠØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†Ø¯ Ø§Ù„ÙƒÙ„
    function changeVideo() {
        const url = document.getElementById('urlInput').value;
        if(url) {
            db.set({
                url: url,
                status: "play",
                time: 0,
                lastUpdated: Date.now()
            });
        }
    }

    // 2. Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Firebase
    db.on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        isUpdating = true; // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ø°Ø§ Ø§Ø®ØªÙ„Ù
        if (player.src !== data.url) {
            player.src = data.url;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙØ±Ù‚ Ø£ÙƒØ«Ø± Ù…Ù† Ø«Ø§Ù†ÙŠØªÙŠÙ† (Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©)
        if (Math.abs(player.currentTime - data.time) > 2) {
            player.currentTime = data.time;
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„/Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
        if (data.status === "play" && player.paused) {
            player.play().catch(() => console.log("ØªØ·Ù„Ø¨ ØªÙØ§Ø¹Ù„ Ù…Ø³ØªØ®Ø¯Ù…"));
        } else if (data.status === "pause" && !player.paused) {
            player.pause();
        }

        setTimeout(() => { isUpdating = false; }, 500);
    });

    // 3. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¹Ù†Ø¯ Ø¶ØºØ·Ùƒ Ø£Ù†Øª Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø´ØºÙ„
    player.onplay = () => {
        if (!isUpdating) db.child('status').set("play");
    };

    player.onpause = () => {
        if (!isUpdating) db.child('status').set("pause");
    };

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø¯ÙˆØ±ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù„ÙŠØ¹Ø±Ù Ø§Ù„Ø¬Ø¯Ø¯ Ø£ÙŠÙ† ÙˆØµÙ„ Ø§Ù„Ø¨Ø«
    player.ontimeupdate = () => {
        if (!isUpdating && !player.paused) {
            // Ù†Ø­Ø¯Ø« Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ 3 Ø«ÙˆØ§Ù†ÙŠ Ù„ØªØ®ÙÙŠÙ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
            if (Math.floor(player.currentTime) % 3 === 0) {
                db.child('time').set(player.currentTime);
            }
        }
    };
</script>

</body>
</html>
