<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± - iOS Optimized</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        :root { --primary: #007AFF; --bg: #000000; --card: #1C1C1E; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg); color: white; margin: 0; padding: 0;
            display: flex; flex-direction: column; height: 100vh;
        }
        .header { padding: 20px; text-align: center; background: var(--card); border-bottom: 1px solid #333; }
        .content { padding: 15px; flex: 1; display: flex; flex-direction: column; gap: 15px; }
        
        .input-box {
            background: var(--card); padding: 15px; border-radius: 15px;
            display: flex; flex-direction: column; gap: 10px;
        }
        input { 
            background: #2C2C2E; border: none; padding: 12px; border-radius: 10px; 
            color: white; font-size: 16px; /* Ø­Ø¬Ù… 16 ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙˆÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø£ÙŠÙÙˆÙ† */
        }
        button { 
            background: var(--primary); color: white; border: none; padding: 12px; 
            border-radius: 10px; font-weight: 600; font-size: 16px; active: opacity: 0.7;
        }

        .video-container {
            position: relative; width: 100%; background: #000; border-radius: 15px; overflow: hidden;
            aspect-ratio: 16 / 9;
        }
        video { width: 100%; height: 100%; object-fit: contain; }

        .status-bar { font-size: 12px; color: #8E8E93; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

<div class="header">
    <h3 style="margin:0;">ØªØ­ÙƒÙ… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ğŸ“º</h3>
</div>

<div class="content">
    <div class="video-container">
        <video id="livePlayer" controls playsinline webkit-playsinline preload="auto"></video>
    </div>

    <div class="input-box">
        <input type="url" id="urlInput" placeholder="Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· mp4 Ù‡Ù†Ø§...">
        <button onclick="changeVideo()">ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
    </div>

    <div class="status-bar" id="syncStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
        authDomain: "videos-5e336.firebaseapp.com",
        databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
        projectId: "videos-5e336",
        storageBucket: "videos-5e336.firebasestorage.app",
        messagingSenderId: "300218651134",
        appId: "1:300218651134:web:4bd24df8e555e62828f0af"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('live_sync');
    const player = document.getElementById('livePlayer');
    let isUpdating = false;

    function changeVideo() {
        const url = document.getElementById('urlInput').value;
        if(url) {
            db.set({ url: url, status: "play", time: 0, lastUpdated: Date.now() });
        }
    }

    db.on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;
        isUpdating = true;

        if (player.src !== data.url) player.src = data.url;
        if (Math.abs(player.currentTime - data.time) > 2) player.currentTime = data.time;

        if (data.status === "play" && player.paused) {
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø£ÙŠÙÙˆÙ† Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ø¶ØºØ·Ø© ÙŠØ¯ÙˆÙŠØ© Ø£ÙˆÙ„ Ù…Ø±Ø© Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØµÙˆØª
            player.play().catch(() => { document.getElementById('syncStatus').innerText = "Ø§Ø¶ØºØ· Play Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©"; });
        } else if (data.status === "pause" && !player.paused) {
            player.pause();
        }
        setTimeout(() => { isUpdating = false; }, 500);
    });

    player.onplay = () => { if (!isUpdating) db.child('status').set("play"); };
    player.onpause = () => { if (!isUpdating) db.child('status').set("pause"); };
    
    player.ontimeupdate = () => {
        if (!isUpdating && !player.paused && Math.floor(player.currentTime) % 3 === 0) {
            db.child('time').set(player.currentTime);
        }
    };
</script>

</body>
</html>
